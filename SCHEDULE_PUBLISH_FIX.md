# ุฌุฏููุฉ ุงููุดุฑ (Schedule Publishing) - ุฅุตูุงุญ ุดุงูู

## ุงููุดููุฉ ุงูุฃุณุงุณูุฉ โ
ุนูุฏ ุฌุฏููุฉ ููุดูุฑ ูููุดุฑ ูู ุชุงุฑูุฎ ูููุช ูุนููุ ูู ูุชู ูุดุฑู ูู ุงูููุช ุงููุญุฏุฏ ูุงูุทุงุจุน ุงูุฒููู ุงููุญููุธ ูุงู ุฎุงุทุฆ.

**ุงูุฃุณุจุงุจ:**
1. **PublishContent Job** ูุงู ูุณุชุจุฏู `published_at` ุจุงูููุช ุงูุญุงูู `now()`
2. **ูุง ุชูุฌุฏ ุชุญูู ูู ุงูุฌุงูุจ ุงูุนููู** ูููุน ุงูุฃููุงุช ุงููุงุถูุฉ
3. **ูุฏ ุชููู ููุงู ูุดุงูู ูู ุงูููุทูุฉ ุงูุฒูููุฉ** (timezone)

---

## ุงูุญููู ุงููุทุจูุฉ โ

### 1. ุฅุตูุงุญ PublishContent Job
**ุงูููู:** `app/Jobs/PublishContent.php`

```php
// ูุจู (ุฎุงุทุฆ):
public function handle(): void
{
    $content = Content::findOrFail($this->contentId);
    $content->status = 'published';
    $content->published_at = now();  // โ ูุณุชุจุฏู ุงูููุช ุงููุฌุฏูู
    $content->save();
}

// ุจุนุฏ (ุตุญูุญ):
public function handle(): void
{
    $content = Content::findOrFail($this->contentId);
    
    if ($content->status !== 'scheduled') {
        return;
    }
    
    $content->status = 'published';
    // โ ูุญุงูุธ ุนูู published_at ุงูุฃุตูู
    $content->save();
}
```

**ุงููุงุฆุฏุฉ:** ุงูุทุงุจุน ุงูุฒููู ุงููุญููุธ ุงูุขู ูู ุงูููุช ุงููุฌุฏูู ุงููุนูู ูููุณ ููุช ุงูุชูููุฐ.

---

### 2. ุชุญุณููุงุช ูุงุฌูุฉ ุงููุณุชุฎุฏู
**ุงูููู:** `resources/views/dashboard/addcontent.blade.php`

#### ุฅุถุงูุฉ ุชุนูููุงุช ูุณุงุนุฏุฉ:
```html
<small class="text-muted d-block mt-2">
    ุงุฎุชูุงุฑู: ุงุชุฑู ูุงุฑุบุงู ูููุดุฑ ุงูููุฑู
</small>
<small class="text-muted d-block">
    ุงูููุทูุฉ ุงูุฒูููุฉ: ุดูุงู ุฃูุฑูููุง/ุงูุฌุฒุงุฆุฑ (GMT+1)
</small>
```

**ุงููุงุฆุฏุฉ:** ูููู ุงููุณุชุฎุฏู ุฃู ุงูุญูู ุงุฎุชูุงุฑู ูุงูููุทูุฉ ุงูุฒูููุฉ ุงููุณุชุฎุฏูุฉ.

---

### 3. ุชุญูู ุงูุฌุงูุจ ุงูุนููู
**ุงูููู:** `resources/views/dashboard/addcontent.blade.php` - JavaScript

```javascript
// ุชุญูู ูู ุชุงุฑูุฎ ุงูุฌุฏููุฉ:
if (publishAtValue) {
    const scheduledDate = new Date(publishAtValue);
    const now = new Date();

    if (scheduledDate <= now) {
        e.preventDefault();
        Swal.fire({
            icon: 'warning',
            title: 'ุชุงุฑูุฎ ุบูุฑ ุตุญูุญ',
            text: 'ุชุงุฑูุฎ ุงููุดุฑ ุงููุฌุฏูู ูุฌุจ ุฃู ูููู ูู ุงููุณุชูุจู',
            confirmButtonText: 'ุญุณูุงู'
        });
        return;
    }
}

// ุชุนููู ุงูุญุฏ ุงูุฃุฏูู ููุชุงุฑูุฎ:
const now = new Date();
now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
publishAtInput.min = now.toISOString().slice(0, 16);
```

**ุงููุงุฆุฏุฉ:** 
- ููุน ุงุฎุชูุงุฑ ุฃููุงุช ูุงุถูุฉ
- ูุงุฌูุฉ ุชุงุฑูุฎ ูุญุณููุฉ ูุน ุงูุญุฏ ุงูุฃุฏูู

---

## ููููุฉ ุนูู ุงููุธุงู ุงูุขู ๐

### ุงูุฎุทูุงุช:

1. **ุงููุณุชุฎุฏู ูููุฃ ุงููููุฐุฌ:**
   - ุงูุนููุงูุ ุงูููุฎุตุ ุงููุญุชููุ ุงูุตูุฑุ ุฅูุฎ
   - ูุฎุชุงุฑ ุชุงุฑูุฎ ูููุช ูู ุงููุณุชูุจู

2. **ุงูุชุญูู ูู ุงูุฌุงูุจ ุงูุนููู:**
   - JavaScript ูุชุญูู ูู ุฃู ุงูุชุงุฑูุฎ ูู ุงููุณุชูุจู
   - ูุนุฑุถ ุชุญุฐูุฑ ุฅุฐุง ูุงู ุงูุชุงุฑูุฎ ูุงุถูุงู

3. **ุงูุฅุฑุณุงู ุฅูู ุงูุฎุงุฏู:**
   - `ContentController` ูุณุชูุจู ุงูุทูุจ
   - ูุญูู ุงูุชุงุฑูุฎ ุฅูู ููุทูุฉ ุฒูููุฉ ุตุญูุญุฉ (Africa/Algiers)

4. **ูุนุงูุฌุฉ ุงูุฎุงุฏู:**
   ```php
   if ($scheduledTime->gt(now('Africa/Algiers'))) {
       // ุฅุฐุง ูุงู ุงูุชุงุฑูุฎ ูู ุงููุณุชูุจู
       $content->status = 'scheduled';
       $content->published_at = $scheduledTime;  // โ ูุญููุธ ุจุดูู ุตุญูุญ
       
       // ุญุณุงุจ ุงูุชุฃุฎูุฑ ูุฅุฑุณุงู ุงููุธููุฉ
       $delayInSeconds = now('Africa/Algiers')->diffInSeconds($scheduledTime);
       PublishContent::dispatch($content->id)->delay(now()->addSeconds($delayInSeconds));
   }
   ```

5. **ุงูููุช ุงููุฌุฏูู ูุตู:**
   - ุชููุฐ ูุธููุฉ `PublishContent`
   - ุชุชุญูู ูู ุญุงูุฉ ุงููุญุชูู (ูุฌุจ ุฃู ุชููู 'scheduled')
   - ุชุญุฏุซ ุงูุญุงูุฉ ุฅูู 'published'
   - **ุชุญุชูุธ ุจู `published_at` ุงูุฃุตูู** โ

---

## ุงูููุทูุฉ ุงูุฒูููุฉ ๐

- **ุงูููุทูุฉ ุงููุณุชุฎุฏูุฉ:** `Africa/Algiers` (GMT+1 ูู ุงูุดุชุงุกุ GMT+2 ูู ุงูุตูู)
- **ูุชู ูุนุงูุฌุฉ ุชุญููู ุงูููุทูุฉ ุงูุฒูููุฉ ุชููุงุฆูุงู** ูู:
  - `ContentController.php` - ุนูุฏ ุงูุงุณุชูุจุงู
  - `PublishContent.php` - ุนูุฏ ุงูุชูููุฐ

---

## ูุซุงู ุนููู ๐

### ุงูุณููุงุฑูู:
- ุงูููุช ุงูุญุงูู: **10 ููููุจุฑ 2025 ุงูุณุงุนุฉ 14:00**
- ุงููุณุชุฎุฏู ูุญุฏุฏ: **10 ููููุจุฑ 2025 ุงูุณุงุนุฉ 18:00**

### ุงููุณุงุฑ:
1. โ ุงูุชุญูู: 18:00 > 14:00 โ ุฌูุฏ
2. โ ุงูุญูุธ: `status = 'scheduled'`, `published_at = 2025-11-10 18:00:00`
3. โ ุงููุธููุฉ: ุชุคุฎุฑ ููุฏุฉ 4 ุณุงุนุงุช
4. โ ุนูุฏ 18:00: ุชููุฐ `PublishContent` 
5. โ ุงููุชูุฌุฉ: `status = 'published'`, `published_at = 2025-11-10 18:00:00` (ุจุฏูู ุชุบููุฑ)

---

## ุงูุงุฎุชุจุงุฑ โ๏ธ

### ููุชุฃูุฏ ูู ุฃู ูู ุดูุก ูุนูู:

1. **ุงุฎุชุจุฑ ุงูุฌุงูุจ ุงูุนููู:**
   - ุฌุฑุจ ุงุฎุชูุงุฑ ููุช ูุงุถู โ ูุฌุจ ุฃู ูุนุฑุถ ุชุญุฐูุฑ
   - ุฌุฑุจ ุงุฎุชูุงุฑ ููุช ูู ุงููุณุชูุจู โ ูุฌุจ ุฃู ููุจู

2. **ุงุฎุชุจุฑ ุงูุฌุงูุจ ุงูุฎุงุฏู:**
   - ุฃูุดุฆ ููุดูุฑ ูุฌุฏูู
   - ุชุญูู ูู `content.status` = 'scheduled'
   - ุชุญูู ูู `content.published_at` = ุงูุชุงุฑูุฎ ุงููุฌุฏูู

3. **ุงุฎุชุจุฑ ุงููุธููุฉ:**
   - ุงูุชุธุฑ ุญุชู ูุตู ุงูููุช ุงููุฌุฏูู
   - ุชุฃูุฏ ูู ุฃู `content.status` ุชุบูุฑ ุฅูู 'published'
   - ุชุญูู ูู ุฃู `published_at` ุจูู **ููุง ูู**

---

## ุงููููุงุช ุงููุนุฏูุฉ ๐

1. โ `app/Jobs/PublishContent.php` - ุฅุฒุงูุฉ ุงุณุชุจุฏุงู `published_at`
2. โ `resources/views/dashboard/addcontent.blade.php` - ุฅุถุงูุฉ ุชุนูููุงุช ูุชุญูู
3. โ (ูู ููุฒู ุชุนุฏูู) `app/Http/Controllers/ContentController.php` - ุงูููุฏ ูุงู ุตุญูุญุงู ุจุงููุนู

---

## ูุตุงุฆุญ ุฅุถุงููุฉ ๐ก

- ุชุฃูุฏ ูู ุฃู ุฎุงุฏูู ูุดุบู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ (queue):
  ```bash
  php artisan queue:work
  ```

- ููููู ูุฑุงูุจุฉ ุงููุธุงุฆู ุงููุฌุฏููุฉ:
  ```bash
  php artisan queue:failed
  ```

- ูู ุงูุฅูุชุงุฌุ ุงุณุชุฎุฏู:
  ```bash
  supervisor
  ```
  ูุชุดุบูู queue worker ุจุดูู ุฏุงุฆู

---

## ุงูุฎูุงุตุฉ ๐ฏ

โ **ุฌุฏููุฉ ุงููุดุฑ ุงูุขู ุชุนูู ุจุดูู ุตุญูุญ!**
- ุงูุทุงุจุน ุงูุฒููู ููุญูุธ ุจุดูู ุตุญูุญ
- ุงููุญุชูู ููุดุฑ ูู ุงูููุช ุงููุญุฏุฏ ุชูุงูุงู
- ุงูููุทูุฉ ุงูุฒูููุฉ ูุนุงูุฌุฉ ุจุดูู ุตุญูุญ
- ููุฌุฏ ุชุญูู ูู ุงูุฌุงูุจ ุงูุนููู ูุงูุฎุงุฏู
